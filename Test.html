<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>Device Orientation API test IF</title>
		
		<!-- Feuille de style mise en page/forme -->
		<link rel="stylesheet" href="css/styles.css" type="text/css">
		
		<!-- Script javascript -->
		<script>	
			var begin=new Date() //récupère la date en cours nombre de ms 
			var msg="timeline;x;y;z ";
			var stop=false;
			function process(event) {
				var alpha = event.alpha;
				var beta = event.beta;
				var gamma = event.gamma;
				
		
				
				// Modification de la section orientation dans la page HTML
				document.getElementById('orientation').innerHTML = "<ul><li>Alpha : " + alpha + "</li><li>Beta : " + beta + "</li><li>Gamma : " + gamma + "</li></ul>";
			}
			
			
			function processmotion(event) {
				
				var x = event.accelerationIncludingGravity.x;
				var y = event.accelerationIncludingGravity.y;
				var z = event.accelerationIncludingGravity.z;
				
				/*var temps = new Date()-begin;
					msg=temps+";"+x+";"+y+";"+z+" ";
				var xhttp = new XMLHttpRequest();						
						xhttp.open("GET", "exemple3sub.php?nomfichier=resultat.csv&texteaecrire="+msg, true);
						xhttp.send();
					*/	
						//document.write("test");
				if((new Date()-begin)>5000){
					if(!stop){
						var xhttp = new XMLHttpRequest();						
						xhttp.open("GET", "exemple3sub.php?nomfichier=resultat.csv&texteaecrire="+msg, true);
						xhttp.send();
						
						xhttp.open("GET", "exemple3sub.php?nomfichier=resultat.txt&texteaecrire="+msg, true);
						xhttp.send();
						
						stop=true;
						//alert("Message envoyé");
						

						
						alert(msg);
					}
				}else{
					var temps = new Date()-begin;
					msg=msg+temps+";"+x+";"+y+";"+z+" ";
				}
				
				
				// Modification de la section acceleration dans la page HTML
				document.getElementById('acceleration').innerHTML = "<ul><li>X : " + x + "</li><li>Y : " + y + "</li><li>Z : " + z + "</li><li>Temps écoulé: "+(new Date() - begin)+"</li></ul>";
		
		}
												
			// Attention : l'ordre de gestion des deux types d'évenements ci-dessous est important et peut générer des comportements imprévus sur certains téléphones
												
			// Dès que l'évenement "devicemotion" est émis ( rafraichissement du capteur) la fonction processmotion est appellée 
			window.addEventListener("devicemotion", processmotion, true);	
			
			// Dès que l'évenement "deviceorientation" est émis ( rafraichissement du capteur) la fonction process est appellée 			
			window.addEventListener("deviceorientation", process, true);
					
		</script>	
		
	</head>
		
	<body>

	<h1>Orientation API</h1>

	<div id="wrap">

		<h2>Démonstration</h2>

		<div id="orientation"> <!-- La section pour afficher les données d'orientation. -->
			<ul>
				<li>Alpha : </li>
				<li>Beta : </li>
				<li>Gamma : </li>
				<li>Temps écoulé : </li>
			</ul>
		</div>
		
		<div id="acceleration"> <!-- La section pour afficher les données d'accélération. -->
			<ul>
				<li>X : </li>
				<li>Y: </li>
				<li>Z: </li>
			</ul>
		</div>
	
	</div>
	
	
	
	</body>
</html>
